package com.redhat.unit.entitiesTests;

import com.atlassian.jira.rest.client.api.domain.Issue;
import com.atlassian.jira.rest.client.api.domain.Status;
import com.atlassian.jira.rest.client.api.domain.User;
import com.redhat.tasksyncer.dao.entities.issues.AbstractIssue;
import com.redhat.tasksyncer.dao.entities.issues.JiraIssue;
import com.redhat.tasksyncer.dao.enumerations.IssueType;
import org.joda.time.DateTime;
import org.json.JSONException;
import org.json.JSONObject;
import org.junit.Before;
import org.junit.Test;

import java.net.URI;
import java.util.*;

import static org.assertj.core.api.AssertionsForClassTypes.assertThat;


public class JiraIssueTests {

    String jsonInputIssueChanged;
    String jsonInputNoDescription;
    String jsonInputNullDescription;
    String jsonInputIssueChangedFromDecoder;

    JSONObject jsonObject;
    Issue jiraIssueTwo;

    Issue jiraIssueOne;
    List<String> labels;

    String label_name = "label";
    String assigneeName = "assignee";
    String titleOne = "Title_one";
    String description = "description";
    Date dueDate = new Date();
    Date createdAt = new Date();
    Date closedAt = new Date();

    Map<String, String> columnMapping = new LinkedHashMap<>();


    @Before
    public void setup() throws JSONException {
        jsonInputIssueChanged = "{\"timestamp\":1569402421534,\"webhookEvent\":\"jira:issue_created\",\"issue_event_type_name\":\"issue_created\",\"user\":{\"self\":\"https://drajnoha.atlassian.net/rest/api/2/user?accountId=5c8a699f4c5068698da7ae9e\",\"accountId\":\"5c8a699f4c5068698da7ae9e\",\"emailAddress\":\"\\\"?\\\"\",\"avatarUrls\":{\"48x48\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=48&s=48\",\"24x24\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=24&s=24\",\"16x16\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=16&s=16\",\"32x32\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=32&s=32\"},\"displayName\":\"DavidRajnoha\",\"active\":true,\"timeZone\":\"Europe/Prague\",\"accountType\":\"atlassian\"},\"issue\":{\"id\":\"10002\",\"self\":\"https://drajnoha.atlassian.net/rest/api/2/issue/10002\",\"key\":\"JIR-3\",\"fields\":{\"statuscategorychangedate\":null,\"issuetype\":{\"self\":\"https://drajnoha.atlassian.net/rest/api/2/issuetype/10002\",\"id\":\"10002\",\"description\":\"Asmall,distinctpiecesofwork.\",\"iconUrl\":\"https://drajnoha.atlassian.net/secure/viewavatar?size=medium&avatarId=10318&avatarType=issuetype\",\"name\":\"Task\",\"subtask\":false,\"avatarId\":10318},\"timespent\":null,\"project\":{\"self\":\"https://drajnoha.atlassian.net/rest/api/2/project/10000\",\"id\":\"10000\",\"key\":\"JIR\",\"name\":\"JiraTesting\",\"projectTypeKey\":\"software\",\"simplified\":false,\"avatarUrls\":{\"48x48\":\"https://drajnoha.atlassian.net/secure/projectavatar?pid=10000&avatarId=10419\",\"24x24\":\"https://drajnoha.atlassian.net/secure/projectavatar?size=small&s=small&pid=10000&avatarId=10419\",\"16x16\":\"https://drajnoha.atlassian.net/secure/projectavatar?size=xsmall&s=xsmall&pid=10000&avatarId=10419\",\"32x32\":\"https://drajnoha.atlassian.net/secure/projectavatar?size=medium&s=medium&pid=10000&avatarId=10419\"}},\"fixVersions\":[],\"aggregatetimespent\":null,\"resolution\":null,\"resolutiondate\":null,\"workratio\":-1,\"lastViewed\":null,\"watches\":{\"self\":\"https://drajnoha.atlassian.net/rest/api/2/issue/JIR-3/watchers\",\"watchCount\":0,\"isWatching\":true},\"created\":\"2019-09-25T11:07:01.437+0200\",\"customfield_10020\":null,\"customfield_10021\":null,\"customfield_10022\":null,\"customfield_10023\":null,\"priority\":{\"self\":\"https://drajnoha.atlassian.net/rest/api/2/priority/3\",\"iconUrl\":\"https://drajnoha.atlassian.net/images/icons/priorities/medium.svg\",\"name\":\"Medium\",\"id\":\"3\"},\"labels\":[],\"customfield_10016\":null,\"customfield_10017\":null,\"customfield_10018\":{\"hasEpicLinkFieldDependency\":false,\"showField\":false,\"nonEditableReason\":{\"reason\":\"PLUGIN_LICENSE_ERROR\",\"message\":\"PortfolioforJiramustbelicensedfortheParentLinktobeavailable.\"}},\"customfield_10019\":\"0|i0000f:\",\"aggregatetimeoriginalestimate\":null,\"timeestimate\":null,\"versions\":[],\"issuelinks\":[],\"assignee\":null,\"updated\":\"2019-09-25T11:07:01.437+0200\",\"status\":{\"self\":\"https://drajnoha.atlassian.net/rest/api/2/status/10000\",\"description\":\"\",\"iconUrl\":\"https://drajnoha.atlassian.net/\",\"name\":\"Backlog\",\"id\":\"10000\",\"statusCategory\":{\"self\":\"https://drajnoha.atlassian.net/rest/api/2/statuscategory/2\",\"id\":2,\"key\":\"new\",\"colorName\":\"blue-gray\",\"name\":\"New\"}},\"components\":[],\"timeoriginalestimate\":null,\"description\":null,\"customfield_10010\":null,\"customfield_10014\":null,\"timetracking\":{},\"customfield_10015\":null,\"customfield_10005\":null,\"customfield_10006\":null,\"security\":null,\"customfield_10007\":null,\"customfield_10008\":null,\"attachment\":[],\"customfield_10009\":null,\"aggregatetimeestimate\":null,\"summary\":\"Issuetestingwednesday\",\"creator\":{\"self\":\"https://drajnoha.atlassian.net/rest/api/2/user?accountId=5c8a699f4c5068698da7ae9e\",\"name\":\"admin\",\"key\":\"admin\",\"accountId\":\"5c8a699f4c5068698da7ae9e\",\"emailAddress\":\"drajnoha@seznam.cz\",\"avatarUrls\":{\"48x48\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=48&s=48\",\"24x24\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=24&s=24\",\"16x16\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=16&s=16\",\"32x32\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=32&s=32\"},\"displayName\":\"DavidRajnoha\",\"active\":true,\"timeZone\":\"Europe/Prague\",\"accountType\":\"atlassian\"},\"subtasks\":[],\"reporter\":{\"self\":\"https://drajnoha.atlassian.net/rest/api/2/user?accountId=5c8a699f4c5068698da7ae9e\",\"name\":\"admin\",\"key\":\"admin\",\"accountId\":\"5c8a699f4c5068698da7ae9e\",\"emailAddress\":\"drajnoha@seznam.cz\",\"avatarUrls\":{\"48x48\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=48&s=48\",\"24x24\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=24&s=24\",\"16x16\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=16&s=16\",\"32x32\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=32&s=32\"},\"displayName\":\"DavidRajnoha\",\"active\":true,\"timeZone\":\"Europe/Prague\",\"accountType\":\"atlassian\"},\"customfield_10000\":\"{}\",\"aggregateprogress\":{\"progress\":0,\"total\":0},\"customfield_10001\":null,\"customfield_10002\":null,\"customfield_10003\":null,\"customfield_10004\":null,\"environment\":null,\"duedate\":null,\"progress\":{\"progress\":0,\"total\":0},\"votes\":{\"self\":\"https://drajnoha.atlassian.net/rest/api/2/issue/JIR-3/votes\",\"votes\":0,\"hasVoted\":false}}}}";
        jsonInputNullDescription = "{\"timestamp\":1571760525252,\"webhookEvent\":\"jira:issue_created\",\"issue_event_type_name\":\"issue_created\",\"user\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/user?accountId=5c8a699f4c5068698da7ae9e\",\"accountId\":\"5c8a699f4c5068698da7ae9e\",\"emailAddress\":\"?\",\"avatarUrls\":{\"48x48\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=48&s=48\",\"24x24\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=24&s=24\",\"16x16\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=16&s=16\",\"32x32\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=32&s=32\"},\"displayName\":\"DavidRajnoha\",\"active\":true,\"timeZone\":\"Europe/Prague\",\"accountType\":\"atlassian\"},\"issue\":{\"id\":\"10029\",\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/10029\",\"key\":\"TAS-30\",\"fields\":{\"statuscategorychangedate\":\"2019-10-22T18:08:45.344+0200\",\"issuetype\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/issuetype/10002\",\"id\":\"10002\",\"description\":\"Asmall,distinctpiecesofwork.\",\"iconUrl\":\"https://drajnohatasksyncer.atlassian.net/secure/viewavatar?size=medium&avatarId=10318&avatarType=issuetype\",\"name\":\"Task\",\"subtask\":false,\"avatarId\":10318},\"timespent\":null,\"project\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/project/10000\",\"id\":\"10000\",\"key\":\"TAS\",\"name\":\"tasksyncer\",\"projectTypeKey\":\"software\",\"simplified\":false,\"avatarUrls\":{\"48x48\":\"https://drajnohatasksyncer.atlassian.net/secure/projectavatar?pid=10000&avatarId=10406\",\"24x24\":\"https://drajnohatasksyncer.atlassian.net/secure/projectavatar?size=small&s=small&pid=10000&avatarId=10406\",\"16x16\":\"https://drajnohatasksyncer.atlassian.net/secure/projectavatar?size=xsmall&s=xsmall&pid=10000&avatarId=10406\",\"32x32\":\"https://drajnohatasksyncer.atlassian.net/secure/projectavatar?size=medium&s=medium&pid=10000&avatarId=10406\"}},\"fixVersions\":[],\"aggregatetimespent\":null,\"resolution\":null,\"resolutiondate\":null,\"workratio\":-1,\"lastViewed\":null,\"watches\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/issue/TAS-30/watchers\",\"watchCount\":0,\"isWatching\":true},\"created\":\"2019-10-22T18:08:45.201+0200\",\"customfield_10020\":null,\"customfield_10021\":null,\"customfield_10022\":null,\"customfield_10023\":null,\"priority\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/priority/3\",\"iconUrl\":\"https://drajnohatasksyncer.atlassian.net/images/icons/priorities/medium.svg\",\"name\":\"Medium\",\"id\":\"3\"},\"labels\":[],\"customfield_10016\":null,\"customfield_10017\":null,\"customfield_10018\":{\"hasEpicLinkFieldDependency\":false,\"showField\":false,\"nonEditableReason\":{\"reason\":\"PLUGIN_LICENSE_ERROR\",\"message\":\"PortfolioforJiramustbelicensedfortheParentLinktobeavailable.\"}},\"customfield_10019\":\"0|i0006f:\",\"timeestimate\":null,\"aggregatetimeoriginalestimate\":null,\"versions\":[],\"issuelinks\":[],\"assignee\":null,\"updated\":\"2019-10-22T18:08:45.201+0200\",\"status\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/status/10000\",\"description\":\"\",\"iconUrl\":\"https://drajnohatasksyncer.atlassian.net/\",\"name\":\"Backlog\",\"id\":\"10000\",\"statusCategory\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/statuscategory/2\",\"id\":2,\"key\":\"new\",\"colorName\":\"blue-gray\",\"name\":\"New\"}},\"components\":[],\"timeoriginalestimate\":null,\"description\":null,\"customfield_10010\":null,\"customfield_10014\":null,\"customfield_10015\":null,\"timetracking\":{},\"customfield_10005\":null,\"customfield_10006\":null,\"customfield_10007\":null,\"security\":null,\"customfield_10008\":null,\"attachment\":[],\"aggregatetimeestimate\":null,\"customfield_10009\":null,\"summary\":\"Againnodesc\",\"creator\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/user?accountId=5c8a699f4c5068698da7ae9e\",\"name\":\"admin\",\"key\":\"admin\",\"accountId\":\"5c8a699f4c5068698da7ae9e\",\"emailAddress\":\"drajnoha@seznam.cz\",\"avatarUrls\":{\"48x48\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=48&s=48\",\"24x24\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=24&s=24\",\"16x16\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=16&s=16\",\"32x32\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=32&s=32\"},\"displayName\":\"DavidRajnoha\",\"active\":true,\"timeZone\":\"Europe/Prague\",\"accountType\":\"atlassian\"},\"subtasks\":[],\"reporter\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/user?accountId=5c8a699f4c5068698da7ae9e\",\"name\":\"admin\",\"key\":\"admin\",\"accountId\":\"5c8a699f4c5068698da7ae9e\",\"emailAddress\":\"drajnoha@seznam.cz\",\"avatarUrls\":{\"48x48\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=48&s=48\",\"24x24\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=24&s=24\",\"16x16\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=16&s=16\",\"32x32\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=32&s=32\"},\"displayName\":\"DavidRajnoha\",\"active\":true,\"timeZone\":\"Europe/Prague\",\"accountType\":\"atlassian\"},\"customfield_10000\":\"{}\",\"aggregateprogress\":{\"progress\":0,\"total\":0},\"customfield_10001\":null,\"customfield_10002\":null,\"customfield_10003\":null,\"customfield_10004\":null,\"environment\":null,\"duedate\":null,\"progress\":{\"progress\":0,\"total\":0},\"votes\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/issue/TAS-30/votes\",\"votes\":0,\"hasVoted\":false}}},\"changelog\":{\"id\":\"10136\",\"items\":[{\"field\":\"priority\",\"fieldtype\":\"jira\",\"fieldId\":\"priority\",\"from\":null,\"fromString\":null,\"to\":\"3\",\"toString\":\"Medium\"},{\"field\":\"reporter\",\"fieldtype\":\"jira\",\"fieldId\":\"reporter\",\"from\":null,\"fromString\":null,\"to\":\"admin\",\"toString\":\"DavidRajnoha\",\"tmpFromAccountId\":null,\"tmpToAccountId\":\"5c8a699f4c5068698da7ae9e\"},{\"field\":\"Status\",\"fieldtype\":\"jira\",\"fieldId\":\"status\",\"from\":null,\"fromString\":null,\"to\":\"10000\",\"toString\":\"Backlog\"},{\"field\":\"summary\",\"fieldtype\":\"jira\",\"fieldId\":\"summary\",\"from\":null,\"fromString\":null,\"to\":null,\"toString\":\"Againnodesc\"}]}}";
        jsonInputIssueChangedFromDecoder = "{\"timestamp\":1571760525252,\"webhookEvent\":\"jira:issue_created\",\"issue_event_type_name\":\"issue_created\",\"user\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/user?accountId=5c8a699f4c5068698da7ae9e\",\"accountId\":\"5c8a699f4c5068698da7ae9e\",\"emailAddress\":\"?\",\"avatarUrls\":{\"48x48\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=48&s=48\",\"24x24\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=24&s=24\",\"16x16\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=16&s=16\",\"32x32\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=32&s=32\"},\"displayName\":\"David Rajnoha\",\"active\":true,\"timeZone\":\"Europe/Prague\",\"accountType\":\"atlassian\"},\"issue\":{\"id\":\"10029\",\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/10029\",\"key\":\"TAS-30\",\"fields\":{\"statuscategorychangedate\":\"2019-10-22T18:08:45.344+0200\",\"issuetype\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/issuetype/10002\",\"id\":\"10002\",\"description\":\"A small, distinct pieces of work.\",\"iconUrl\":\"https://drajnohatasksyncer.atlassian.net/secure/viewavatar?size=medium&avatarId=10318&avatarType=issuetype\",\"name\":\"Task\",\"subtask\":false,\"avatarId\":10318},\"timespent\":null,\"project\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/project/10000\",\"id\":\"10000\",\"key\":\"TAS\",\"name\":\"tasksyncer\",\"projectTypeKey\":\"software\",\"simplified\":false,\"avatarUrls\":{\"48x48\":\"https://drajnohatasksyncer.atlassian.net/secure/projectavatar?pid=10000&avatarId=10406\",\"24x24\":\"https://drajnohatasksyncer.atlassian.net/secure/projectavatar?size=small&s=small&pid=10000&avatarId=10406\",\"16x16\":\"https://drajnohatasksyncer.atlassian.net/secure/projectavatar?size=xsmall&s=xsmall&pid=10000&avatarId=10406\",\"32x32\":\"https://drajnohatasksyncer.atlassian.net/secure/projectavatar?size=medium&s=medium&pid=10000&avatarId=10406\"}},\"fixVersions\":[],\"aggregatetimespent\":null,\"resolution\":null,\"resolutiondate\":null,\"workratio\":-1,\"lastViewed\":null,\"watches\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/issue/TAS-30/watchers\",\"watchCount\":0,\"isWatching\":true},\"created\":\"2019-10-22T18:08:45.201+0200\",\"customfield_10020\":null,\"customfield_10021\":null,\"customfield_10022\":null,\"customfield_10023\":null,\"priority\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/priority/3\",\"iconUrl\":\"https://drajnohatasksyncer.atlassian.net/images/icons/priorities/medium.svg\",\"name\":\"Medium\",\"id\":\"3\"},\"labels\":[],\"customfield_10016\":null,\"customfield_10017\":null,\"customfield_10018\":{\"hasEpicLinkFieldDependency\":false,\"showField\":false,\"nonEditableReason\":{\"reason\":\"PLUGIN_LICENSE_ERROR\",\"message\":\"Portfolio for Jira must be licensed for the Parent Link to be available.\"}},\"customfield_10019\":\"0|i0006f:\",\"timeestimate\":null,\"aggregatetimeoriginalestimate\":null,\"versions\":[],\"issuelinks\":[],\"assignee\":null,\"updated\":\"2019-10-22T18:08:45.201+0200\",\"status\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/status/10000\",\"description\":\"\",\"iconUrl\":\"https://drajnohatasksyncer.atlassian.net/\",\"name\":\"Backlog\",\"id\":\"10000\",\"statusCategory\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/statuscategory/2\",\"id\":2,\"key\":\"new\",\"colorName\":\"blue-gray\",\"name\":\"New\"}},\"components\":[],\"timeoriginalestimate\":null,\"description\":null,\"customfield_10010\":null,\"customfield_10014\":null,\"customfield_10015\":null,\"timetracking\":{},\"customfield_10005\":null,\"customfield_10006\":null,\"customfield_10007\":null,\"security\":null,\"customfield_10008\":null,\"attachment\":[],\"aggregatetimeestimate\":null,\"customfield_10009\":null,\"summary\":\"Again no desc\",\"creator\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/user?accountId=5c8a699f4c5068698da7ae9e\",\"name\":\"admin\",\"key\":\"admin\",\"accountId\":\"5c8a699f4c5068698da7ae9e\",\"emailAddress\":\"drajnoha@seznam.cz\",\"avatarUrls\":{\"48x48\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=48&s=48\",\"24x24\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=24&s=24\",\"16x16\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=16&s=16\",\"32x32\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=32&s=32\"},\"displayName\":\"David Rajnoha\",\"active\":true,\"timeZone\":\"Europe/Prague\",\"accountType\":\"atlassian\"},\"subtasks\":[],\"reporter\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/user?accountId=5c8a699f4c5068698da7ae9e\",\"name\":\"admin\",\"key\":\"admin\",\"accountId\":\"5c8a699f4c5068698da7ae9e\",\"emailAddress\":\"drajnoha@seznam.cz\",\"avatarUrls\":{\"48x48\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=48&s=48\",\"24x24\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=24&s=24\",\"16x16\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=16&s=16\",\"32x32\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=32&s=32\"},\"displayName\":\"David Rajnoha\",\"active\":true,\"timeZone\":\"Europe/Prague\",\"accountType\":\"atlassian\"},\"customfield_10000\":\"{}\",\"aggregateprogress\":{\"progress\":0,\"total\":0},\"customfield_10001\":null,\"customfield_10002\":null,\"customfield_10003\":null,\"customfield_10004\":null,\"environment\":null,\"duedate\":null,\"progress\":{\"progress\":0,\"total\":0},\"votes\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/issue/TAS-30/votes\",\"votes\":0,\"hasVoted\":false}}},\"changelog\":{\"id\":\"10136\",\"items\":[{\"field\":\"priority\",\"fieldtype\":\"jira\",\"fieldId\":\"priority\",\"from\":null,\"fromString\":null,\"to\":\"3\",\"toString\":\"Medium\"},{\"field\":\"reporter\",\"fieldtype\":\"jira\",\"fieldId\":\"reporter\",\"from\":null,\"fromString\":null,\"to\":\"admin\",\"toString\":\"David Rajnoha\",\"tmpFromAccountId\":null,\"tmpToAccountId\":\"5c8a699f4c5068698da7ae9e\"},{\"field\":\"Status\",\"fieldtype\":\"jira\",\"fieldId\":\"status\",\"from\":null,\"fromString\":null,\"to\":\"10000\",\"toString\":\"Backlog\"},{\"field\":\"summary\",\"fieldtype\":\"jira\",\"fieldId\":\"summary\",\"from\":null,\"fromString\":null,\"to\":null,\"toString\":\"Again no desc\"}]}}";
        jsonInputNoDescription = "{\"timestamp\":1571760525252,\"webhookEvent\":\"jira:issue_created\",\"issue_event_type_name\":\"issue_created\",\"user\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/user?accountId=5c8a699f4c5068698da7ae9e\",\"accountId\":\"5c8a699f4c5068698da7ae9e\",\"emailAddress\":\"?\",\"avatarUrls\":{\"48x48\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=48&s=48\",\"24x24\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=24&s=24\",\"16x16\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=16&s=16\",\"32x32\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=32&s=32\"},\"displayName\":\"DavidRajnoha\",\"active\":true,\"timeZone\":\"Europe/Prague\",\"accountType\":\"atlassian\"},\"issue\":{\"id\":\"10029\",\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/10029\",\"key\":\"TAS-30\",\"fields\":{\"statuscategorychangedate\":\"2019-10-22T18:08:45.344+0200\",\"issuetype\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/issuetype/10002\",\"id\":\"10002\",\"description\":\"Asmall,distinctpiecesofwork.\",\"iconUrl\":\"https://drajnohatasksyncer.atlassian.net/secure/viewavatar?size=medium&avatarId=10318&avatarType=issuetype\",\"name\":\"Task\",\"subtask\":false,\"avatarId\":10318},\"timespent\":null,\"project\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/project/10000\",\"id\":\"10000\",\"key\":\"TAS\",\"name\":\"tasksyncer\",\"projectTypeKey\":\"software\",\"simplified\":false,\"avatarUrls\":{\"48x48\":\"https://drajnohatasksyncer.atlassian.net/secure/projectavatar?pid=10000&avatarId=10406\",\"24x24\":\"https://drajnohatasksyncer.atlassian.net/secure/projectavatar?size=small&s=small&pid=10000&avatarId=10406\",\"16x16\":\"https://drajnohatasksyncer.atlassian.net/secure/projectavatar?size=xsmall&s=xsmall&pid=10000&avatarId=10406\",\"32x32\":\"https://drajnohatasksyncer.atlassian.net/secure/projectavatar?size=medium&s=medium&pid=10000&avatarId=10406\"}},\"fixVersions\":[],\"aggregatetimespent\":null,\"resolution\":null,\"resolutiondate\":null,\"workratio\":-1,\"lastViewed\":null,\"watches\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/issue/TAS-30/watchers\",\"watchCount\":0,\"isWatching\":true},\"created\":\"2019-10-22T18:08:45.201+0200\",\"customfield_10020\":null,\"customfield_10021\":null,\"customfield_10022\":null,\"customfield_10023\":null,\"priority\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/priority/3\",\"iconUrl\":\"https://drajnohatasksyncer.atlassian.net/images/icons/priorities/medium.svg\",\"name\":\"Medium\",\"id\":\"3\"},\"labels\":[],\"customfield_10016\":null,\"customfield_10017\":null,\"customfield_10018\":{\"hasEpicLinkFieldDependency\":false,\"showField\":false,\"nonEditableReason\":{\"reason\":\"PLUGIN_LICENSE_ERROR\",\"message\":\"PortfolioforJiramustbelicensedfortheParentLinktobeavailable.\"}},\"customfield_10019\":\"0|i0006f:\",\"timeestimate\":null,\"aggregatetimeoriginalestimate\":null,\"versions\":[],\"issuelinks\":[],\"assignee\":null,\"updated\":\"2019-10-22T18:08:45.201+0200\",\"status\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/status/10000\",\"iconUrl\":\"https://drajnohatasksyncer.atlassian.net/\",\"name\":\"Backlog\",\"id\":\"10000\",\"statusCategory\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/statuscategory/2\",\"id\":2,\"key\":\"new\",\"colorName\":\"blue-gray\",\"name\":\"New\"}},\"components\":[],\"timeoriginalestimate\":null,\"customfield_10010\":null,\"customfield_10014\":null,\"customfield_10015\":null,\"timetracking\":{},\"customfield_10005\":null,\"customfield_10006\":null,\"customfield_10007\":null,\"security\":null,\"customfield_10008\":null,\"attachment\":[],\"aggregatetimeestimate\":null,\"customfield_10009\":null,\"summary\":\"Againnodesc\",\"creator\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/user?accountId=5c8a699f4c5068698da7ae9e\",\"name\":\"admin\",\"key\":\"admin\",\"accountId\":\"5c8a699f4c5068698da7ae9e\",\"emailAddress\":\"drajnoha@seznam.cz\",\"avatarUrls\":{\"48x48\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=48&s=48\",\"24x24\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=24&s=24\",\"16x16\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=16&s=16\",\"32x32\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=32&s=32\"},\"displayName\":\"DavidRajnoha\",\"active\":true,\"timeZone\":\"Europe/Prague\",\"accountType\":\"atlassian\"},\"subtasks\":[],\"reporter\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/user?accountId=5c8a699f4c5068698da7ae9e\",\"name\":\"admin\",\"key\":\"admin\",\"accountId\":\"5c8a699f4c5068698da7ae9e\",\"emailAddress\":\"drajnoha@seznam.cz\",\"avatarUrls\":{\"48x48\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=48&s=48\",\"24x24\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=24&s=24\",\"16x16\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=16&s=16\",\"32x32\":\"https://secure.gravatar.com/avatar/6ed85e64767d7058bc8ea52dce47f9e2?d=https%3A%2F%2Favatar-management--avatars.us-west-2.prod.public.atl-paas.net%2Finitials%2FDR-6.png&size=32&s=32\"},\"displayName\":\"DavidRajnoha\",\"active\":true,\"timeZone\":\"Europe/Prague\",\"accountType\":\"atlassian\"},\"customfield_10000\":\"{}\",\"aggregateprogress\":{\"progress\":0,\"total\":0},\"customfield_10001\":null,\"customfield_10002\":null,\"customfield_10003\":null,\"customfield_10004\":null,\"environment\":null,\"duedate\":null,\"progress\":{\"progress\":0,\"total\":0},\"votes\":{\"self\":\"https://drajnohatasksyncer.atlassian.net/rest/api/2/issue/TAS-30/votes\",\"votes\":0,\"hasVoted\":false}}},\"changelog\":{\"id\":\"10136\",\"items\":[{\"field\":\"priority\",\"fieldtype\":\"jira\",\"fieldId\":\"priority\",\"from\":null,\"fromString\":null,\"to\":\"3\",\"toString\":\"Medium\"},{\"field\":\"reporter\",\"fieldtype\":\"jira\",\"fieldId\":\"reporter\",\"from\":null,\"fromString\":null,\"to\":\"admin\",\"toString\":\"DavidRajnoha\",\"tmpFromAccountId\":null,\"tmpToAccountId\":\"5c8a699f4c5068698da7ae9e\"},{\"field\":\"Status\",\"fieldtype\":\"jira\",\"fieldId\":\"status\",\"from\":null,\"fromString\":null,\"to\":\"10000\",\"toString\":\"Backlog\"},{\"field\":\"summary\",\"fieldtype\":\"jira\",\"fieldId\":\"summary\",\"from\":null,\"fromString\":null,\"to\":null,\"toString\":\"Againnodesc\"}]}}";

        columnMapping.put("OPEN", AbstractIssue.STATE_OPENED);
        columnMapping.put("BACKLOG", AbstractIssue.STATE_OPENED);
        columnMapping.put("CLOSED", AbstractIssue.STATE_CLOSED);
        columnMapping.put("OPENED", AbstractIssue.STATE_OPENED);
    }

    @Test
    public void whenJSONtoIssueDecoderIsUsed_thenCorrectAbstractIssueIsCreated() throws JSONException {
        jsonObject = new JSONObject(jsonInputIssueChanged);
        AbstractIssue issue = JiraIssue.ObjectToJiraIssueConverter.convert(jsonObject, columnMapping);
        assertThat(issue.getRemoteIssueId()).isEqualTo("JIR-3");
        assertThat(issue.getTitle()).isEqualTo("Issuetestingwednesday");
        assertThat(issue.getDescription()).isEqualTo("null");
        assertThat(issue.getState()).isEqualTo(AbstractIssue.STATE_OPENED);
    }

    @Test
    public void whenJSONtoIssueDecoderIsUsedOnIssueWithEmptyDescription_thenCorrectAbstractIssueIsCreated() throws JSONException {
        jsonObject = new JSONObject(jsonInputNullDescription);
        AbstractIssue issue = JiraIssue.ObjectToJiraIssueConverter.convert(jsonObject, columnMapping);
        assertThat(issue.getDescription()).isEqualTo("null");
    }

    @Test
    public void whenJSONtoIssueDecoderIsUsedOnIssueWithEmptyDescriptionExactlyAsPassedFromDecoder_thenCorrectAbstractIssueIsCreated() throws JSONException {
        jsonObject = new JSONObject(jsonInputIssueChangedFromDecoder);
        AbstractIssue issue = JiraIssue.ObjectToJiraIssueConverter.convert(jsonObject, columnMapping);
        assertThat(issue.getDescription()).isEqualTo("null");
    }

    @Test
    public void decodingJsonWithoutTheDescriptionField() throws JSONException {
        jsonObject = new JSONObject(jsonInputNoDescription);
        AbstractIssue issue = JiraIssue.ObjectToJiraIssueConverter.convert(jsonObject, columnMapping);
        assertThat(issue.getDescription()).isEqualTo("");
    }

    @Test
    public void whenDecodingIssueFromJRJCIssue_thenAbstractIssueIsCreated(){
        // Preparation
        Status status = new Status(URI.create("uri"), 1L, "opened", "issue is open", null);
        Map<String, URI> avatarURI = new HashMap<String, URI>();
        avatarURI.put("48x48", URI.create("avatar"));

        User assignee = new User(URI.create("assignee"), assigneeName, "David", "dr@email.com", null, avatarURI, null);

        Set<String> labels = new HashSet<>();
        labels.add(label_name);
        labels.add("label_two");


        jiraIssueOne = new Issue(titleOne, null, "JIR-1", 2L, null, null, status, description, null, null, null, null, assignee,
                new DateTime(createdAt), null, new DateTime(dueDate), null, null, null, null, null, new HashSet<>(), null, null,
                null, null, null, null, null, null, null, labels);


        // Test
        AbstractIssue convertedIssue = JiraIssue.ObjectToJiraIssueConverter.convert(jiraIssueOne, columnMapping);

        // Assertion
        assertThat(convertedIssue.getIssueType()).isEqualTo(IssueType.JIRA);
        assertThat(convertedIssue.getTitle()).isEqualTo(titleOne);
        assertThat(convertedIssue.getState()).isEqualTo(AbstractIssue.STATE_OPENED);
        assertThat(convertedIssue.getDescription()).isEqualTo(description);
        assertThat(convertedIssue.getDueDate()).isEqualTo(dueDate);
        assertThat(convertedIssue.getCreatedAt()).isEqualTo(createdAt);
//        assertThat(convertedIssue.getClosedAt()).isEqualTo(closedAt);
        assertThat(convertedIssue.getAssignee()).isEqualTo(assigneeName);
//        assertThat(convertedIssue.getClosedBy()).isEqualTo(assigneeName);
        assertThat(convertedIssue.getRemoteIssueId()).isEqualTo("JIR-1");

        assertThat(convertedIssue.getLabels().isPresent());

        assert(convertedIssue.getLabels().get().contains(label_name));
    }

    @Test
    public void whenDecodingIssueWithNullValuesButId_thenNoExceptionIsThrown(){
        Status status = new Status(URI.create("uri"), 1L, "n", "d", null);
        jiraIssueTwo = new Issue(null, null, "JIR-3", 2L, null, null, status, null, null, null, null, null, null,
                null, null, null, null, null, null, null, null, new HashSet<>(), null, null,
                null, null, null, null, null, null, null, null);

        AbstractIssue convertedIssue = JiraIssue.ObjectToJiraIssueConverter.convert(jiraIssueTwo, columnMapping);

        assertThat(convertedIssue.getRemoteIssueId()).isEqualTo("JIR-3");

    }
}
